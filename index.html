<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>ä»Šå¤©åƒä»€ä¹ˆ V4.0</title>
    <style>
        :root {
            --primary: #FF5E00;
            --drink: #00A3FF;
            --bg: #f2f2f7;
            --card: #fff;
            --text: #1c1c1e;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", "Helvetica Neue", sans-serif;
            background: var(--bg);
            margin: 0;
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* é¡¶éƒ¨å¯¼èˆª */
        .nav {
            padding: 50px 20px 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(255,255,255,0.8);
            backdrop-filter: blur(10px);
            z-index: 100;
        }

        .nav h1 { font-size: 24px; margin: 0; letter-spacing: -0.5px; }
        .nav-btn { font-size: 14px; background: #e5e5ea; padding: 8px 16px; border-radius: 20px; border: none; font-weight: 600; cursor: pointer; }

        /* æ¨¡å¼åˆ‡æ¢ */
        .tabs {
            display: flex;
            margin: 20px;
            background: #e5e5ea;
            padding: 4px;
            border-radius: 12px;
        }
        .tab {
            flex: 1;
            text-align: center;
            padding: 10px;
            border-radius: 8px;
            font-weight: 600;
            font-size: 14px;
            transition: all 0.3s;
        }
        .tab.active { background: #fff; shadow: 0 2px 8px rgba(0,0,0,0.1); }
        .tab.food.active { color: var(--primary); }
        .tab.drink.active { color: var(--drink); }

        /* è€è™æœºè§†çª— */
        .slot-machine-container {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            perspective: 1000px;
            position: relative;
        }

        .slot-window {
            width: 85%;
            height: 200px;
            background: #fff;
            border-radius: 24px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.1);
            overflow: hidden; /* å…³é”®ï¼šéšè—æ»šåŠ¨å†…å®¹ */
            position: relative;
            border: 4px solid #fff;
        }

        /* è£…é¥°çº¿ */
        .slot-window::before {
            content: "";
            position: absolute;
            top: 0; left: 0; right: 0; height: 30px;
            background: linear-gradient(to bottom, rgba(255,255,255,1), rgba(255,255,255,0));
            z-index: 2;
        }
        .slot-window::after {
            content: "";
            position: absolute;
            bottom: 0; left: 0; right: 0; height: 30px;
            background: linear-gradient(to top, rgba(255,255,255,1), rgba(255,255,255,0));
            z-index: 2;
        }

        .reel {
            list-style: none;
            padding: 0;
            margin: 0;
            text-align: center;
            transform: translateY(0); /* åˆå§‹ä½ç½® */
            will-change: transform;
        }

        .reel-item {
            height: 200px; /* å’Œè§†çª—é«˜åº¦ä¸€è‡´ */
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 20px;
            box-sizing: border-box;
        }

        .item-name { font-size: 28px; font-weight: 800; margin-bottom: 10px; line-height: 1.2; }
        .item-meta { font-size: 14px; color: #8e8e93; background: #f2f2f7; padding: 4px 12px; border-radius: 10px; }
        .item-desc { font-size: 12px; color: #aeaeb2; margin-top: 10px; max-width: 80%; }

        /* æ“ä½œåŒº */
        .controls {
            padding: 40px 20px;
            text-align: center;
        }

        .btn-main {
            width: 100%;
            padding: 18px;
            font-size: 18px;
            font-weight: 700;
            color: #fff;
            background: var(--primary);
            border: none;
            border-radius: 16px;
            box-shadow: 0 10px 30px rgba(255, 94, 0, 0.3);
            transition: transform 0.1s;
        }
        .btn-main:active { transform: scale(0.96); }
        .btn-main.drink { background: var(--drink); box-shadow: 0 10px 30px rgba(0, 163, 255, 0.3); }

        /* ç®¡ç†é¢æ¿ (Modal) */
        .modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 200;
            display: none;
            align-items: flex-end; /* åº•éƒ¨å¼¹å‡º */
        }
        .modal.open { display: flex; }

        .modal-content {
            background: #fff;
            width: 100%;
            height: 80vh;
            border-radius: 24px 24px 0 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            animation: slideUp 0.3s ease;
        }

        @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }

        .modal-header { display: flex; justify-content: space-between; margin-bottom: 20px; }
        .list-container { flex: 1; overflow-y: auto; }
        
        .list-item {
            display: flex; justify-content: space-between; align-items: center;
            padding: 15px 0; border-bottom: 1px solid #eee;
        }
        .del-btn { color: red; border: 1px solid red; background: none; padding: 4px 8px; border-radius: 6px; font-size: 12px; }

        .add-form { display: flex; gap: 10px; margin-top: 10px; padding-top: 10px; border-top: 1px solid #eee; }
        .input-box { flex: 1; padding: 10px; border: 1px solid #ddd; border-radius: 8px; background: #f9f9f9; }
    </style>
</head>
<body>

    <div class="nav">
        <h1>ä»Šå¤©åƒä»€ä¹ˆ</h1>
        <button class="nav-btn" onclick="openManager()">âš™ï¸ ç®¡ç†èœå•</button>
    </div>

    <div class="tabs">
        <div class="tab food active" onclick="switchMode('food')">å¹²é¥­æ¨¡å¼</div>
        <div class="tab drink" onclick="switchMode('drink')">ç»­å‘½æ¨¡å¼</div>
    </div>

    <div class="slot-machine-container">
        <div class="slot-window">
            <ul class="reel" id="reel">
                <!-- JS ä¼šåœ¨è¿™é‡Œæ’å…¥å†…å®¹ -->
                <li class="reel-item">
                    <div class="item-name">å‡†å¤‡å°±ç»ª</div>
                    <div class="item-meta">ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®</div>
                </li>
            </ul>
        </div>
    </div>

    <div class="controls">
        <button class="btn-main" id="spin-btn" onclick="spin()">ğŸ° å¼€å§‹éšæœº</button>
    </div>

    <!-- ç®¡ç†é¢æ¿ -->
    <div class="modal" id="manager-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>èœå•ç®¡ç†</h2>
                <button onclick="closeManager()" style="border:none;background:none;font-size:20px">âœ•</button>
            </div>
            <div style="font-size:12px;color:#999;margin-bottom:10px">è¿™äº›æ•°æ®ä¿å­˜åœ¨ä½ çš„æ‰‹æœºé‡Œï¼Œæƒ³åŠ ä»€ä¹ˆè‡ªå·±å¡«ã€‚</div>
            
            <div class="list-container" id="manage-list">
                <!-- åˆ—è¡¨ -->
            </div>

            <div class="add-form">
                <input type="text" id="new-name" class="input-box" placeholder="åç§° (å¦‚: æ¥¼ä¸‹ç‚’ç²‰)">
                <input type="text" id="new-cat" class="input-box" placeholder="åˆ†ç±» (å¦‚: å¿«é¤)" style="width:80px">
                <button onclick="addItem()" style="background:#007aff;color:#fff;border:none;border-radius:8px;padding:0 20px">æ·»åŠ </button>
            </div>
        </div>
    </div>

    <script>
        // 1. åŸºç¡€æ•°æ® (Python ç”Ÿæˆçš„ 50+ æ¡)
        const defaultDB = {
            food: [
                {"n": "éº¦å½“åŠ³Â·åŒå±‚å‰å£«", "s": "å¿«é¤", "d": "ç»å…¸ç¾å‘³"},
                {"n": "æ²™å¿Â·é¸­è…¿é¥­", "s": "å¿«é¤", "d": "æ€§ä»·æ¯”ä¹‹ç‹"},
                {"n": "å…°å·æ‹‰é¢", "s": "é¢é£Ÿ", "d": "ä¸€æ¸…äºŒç™½ä¸‰çº¢å››ç»¿"},
                {"n": "é»„ç„–é¸¡ç±³é¥­", "s": "å¿«é¤", "d": "å›½æ°‘ç›–é¥­"},
                {"n": "éš†æ±ŸçŒªè„šé¥­", "s": "å¿«é¤", "d": "ç”·äººçš„æµªæ¼«"},
                {"n": "å¡”æ–¯æ±€Â·ä¸­å›½æ±‰å ¡", "s": "å¿«é¤", "d": "ç°çƒ¤é¥¼çš®"},
                {"n": "è€ä¹¡é¸¡", "s": "ä¸­é¤", "d": "å¹²å‡€å«ç”Ÿ"},
                {"n": "å¤§ç±³å…ˆç”Ÿ", "s": "ä¸­é¤", "d": "ç°ç‚’å¥½å‘³é“"},
                {"n": "èºè›³ç²‰", "s": "ç²‰é¢", "d": "é—»ç€è‡­åƒç€é¦™"},
                {"n": "éº»è¾£çƒ«", "s": "è‡ªé€‰", "d": "åŠ éº»åŠ è¾£"},
                {"n": "è‚¯å¾·åŸºÂ·å®æŒ‡åŸå‘³é¸¡", "s": "å¿«é¤", "d": "ç»å…¸"},
                {"n": "å‰é‡å®¶Â·ç‰›è‚‰é¥­", "s": "ç›–é¥­", "d": "æ—¥å¼é£å‘³"},
                {"n": "çœŸåŠŸå¤«Â·é¦™æ±æ’éª¨", "s": "ä¸­é¤", "d": "è’¸çš„è¥å…»"},
                {"n": "æ±‰å ¡ç‹Â·çš‡å ¡", "s": "å¿«é¤", "d": "ç«çƒ¤ç‰›è‚‰"},
                {"n": "å¿…èƒœå®¢Â·æ¯”è¨", "s": "è¥¿é¤", "d": "èŠå£«å°±æ˜¯åŠ›é‡"},
                {"n": "è¨è‰äºšÂ·è‚‰é…±é¢", "s": "è¥¿é¤", "d": "ä¾¿å®œå¤§ç¢—"},
                {"n": "é…¸èœé±¼", "s": "å·èœ", "d": "å¤ªäºŒ/é±¼ä½ åœ¨ä¸€èµ·"},
                {"n": "æ–°ç–†ç‚’ç±³ç²‰", "s": "ç²‰é¢", "d": "è¾£åˆ°æµæ±—"},
                {"n": "çƒ§é¸­é¥­", "s": "ç²¤èœ", "d": "çš®è„†è‚‰å«©"},
                {"n": "æ½®æ±•ç‰›è‚‰ç«é”…", "s": "ç«é”…", "d": "é²œå«©"},
                {"n": "æµ·åº•æ", "s": "ç«é”…", "d": "æœåŠ¡å¥½"}
            ],
            drink: [
                {"n": "ç‘å¹¸Â·ç”Ÿæ¤°æ‹¿é“", "s": "å’–å•¡", "d": "yyds"},
                {"n": "èœœé›ªÂ·æŸ æª¬æ°´", "s": "æœèŒ¶", "d": "4å—é’±çš„å¿«ä¹"},
                {"n": "æ˜Ÿå·´å…‹Â·å†°ç¾å¼", "s": "å’–å•¡", "d": "æ¶ˆè‚¿ç¥å™¨"},
                {"n": "éœ¸ç‹èŒ¶å§¬Â·ä¼¯ç‰™ç»å¼¦", "s": "å¥¶èŒ¶", "d": "æ¸…çˆ½ä¸è…»"},
                {"n": "å¤èŒ—Â·è¶…AèŠå£«è‘¡è„", "s": "æœèŒ¶", "d": "èŠå£«æµ“éƒ"},
                {"n": "èŒ¶ç™¾é“Â·æ¨æç”˜éœ²", "s": "æœèŒ¶", "d": "å¥½å–"},
                {"n": "å–œèŒ¶Â·å¤šè‚‰è‘¡è„", "s": "æœèŒ¶", "d": "ç»å…¸"},
                {"n": "å¥ˆé›ªÂ·éœ¸æ°”æ©™å­", "s": "æœèŒ¶", "d": "ç»´Cæ»¡æ»¡"},
                {"n": "ä¸€ç‚¹ç‚¹Â·å››å­£å¥¶é’", "s": "å¥¶èŒ¶", "d": "åŠ æ³¢éœ¸"},
                {"n": "CocoÂ·å¥¶èŒ¶ä¸‰å…„å¼Ÿ", "s": "å¥¶èŒ¶", "d": "æ–™å¤šç®¡é¥±"},
                {"n": "ä¸œæ–¹æ ‘å¶", "s": "ç“¶è£…", "d": "0å¡"},
                {"n": "ä¸‰å¾—åˆ©ä¹Œé¾™èŒ¶", "s": "ç“¶è£…", "d": "æ— ç³–"},
                {"n": "å¯å£å¯ä¹", "s": "ç¢³é…¸", "d": "å¿«ä¹æ°´"},
                {"n": "é›ªç¢§", "s": "ç¢³é…¸", "d": "é€å¿ƒå‡‰"}
            ]
        };

        // 2. çŠ¶æ€ç®¡ç† (LocalStorage)
        let currentMode = 'food';
        
        function loadData() {
            const saved = localStorage.getItem('myFoodMenu_v1');
            if (saved) {
                return JSON.parse(saved);
            } else {
                return defaultDB;
            }
        }

        function saveData(data) {
            localStorage.setItem('myFoodMenu_v1', JSON.stringify(data));
        }

        let db = loadData();

        // 3. æ ¸å¿ƒé€»è¾‘ï¼šè€è™æœºåŠ¨ç”»
        const reel = document.getElementById('reel');
        const spinBtn = document.getElementById('spin-btn');
        let isSpinning = false;

        function switchMode(mode) {
            if (isSpinning) return;
            currentMode = mode;
            
            // UI æ›´æ–°
            document.querySelector('.tab.food').classList.toggle('active', mode === 'food');
            document.querySelector('.tab.drink').classList.toggle('active', mode === 'drink');
            
            const btn = document.getElementById('spin-btn');
            btn.className = mode === 'food' ? 'btn-main' : 'btn-main drink';
            
            // é‡ç½®è½¬ç›˜æ˜¾ç¤º
            const list = db[mode];
            const randomShow = list[Math.floor(Math.random() * list.length)];
            renderStatic(randomShow);
        }

        function renderStatic(item) {
            reel.style.transition = 'none';
            reel.style.transform = 'translateY(0)';
            reel.innerHTML = `
                <li class="reel-item">
                    <div class="item-name">${item.n}</div>
                    <div class="item-meta">${item.s}</div>
                    <div class="item-desc">${item.d || 'ç¾å‘³æ¨è'}</div>
                </li>
            `;
        }

        function spin() {
            if (isSpinning) return;
            isSpinning = true;
            spinBtn.disabled = true;
            spinBtn.innerText = "ğŸ² éšæœºä¸­...";

            const list = db[currentMode];
            const itemHeight = 200; // å¿…é¡»å’Œ CSS reel-item é«˜åº¦ä¸€è‡´
            const rounds = 5; // è½¬å‡ åœˆ
            const totalItems = 30; // è™šæ‹Ÿåˆ—è¡¨é•¿åº¦
            
            // æ„å»ºè™šæ‹Ÿæ»šåŠ¨åˆ—è¡¨
            let html = '';
            // å…ˆåŠ è¿™ä¸€ä¸ªä½œä¸ºèµ·å§‹
            html += reel.innerHTML; 
            
            // ä¸­é—´å¡ä¸€å †éšæœºçš„
            for(let i=0; i<totalItems; i++) {
                const item = list[Math.floor(Math.random() * list.length)];
                html += `
                    <li class="reel-item">
                        <div class="item-name">${item.n}</div>
                        <div class="item-meta">${item.s}</div>
                    </li>
                `;
            }
            
            // æœ€åä¸€ä¸ªä½œä¸ºç»“æœ
            const finalItem = list[Math.floor(Math.random() * list.length)];
            html += `
                <li class="reel-item">
                    <div class="item-name" style="color:${currentMode=='food'?'#FF5E00':'#00A3FF'}">${finalItem.n}</div>
                    <div class="item-meta">${finalItem.s}</div>
                    <div class="item-desc">${finalItem.d || 'å‘½ä¸­æ³¨å®š'}</div>
                </li>
            `;

            reel.innerHTML = html;
            
            // å¼ºåˆ¶é‡ç»˜
            reel.offsetHeight;

            // å¼€å§‹åŠ¨ç”»
            // è®¡ç®—æ»šåŠ¨è·ç¦»ï¼š(æ€»æ•° - 1) * é«˜åº¦
            // ä½¿ç”¨ cubic-bezier å®ç° "å¿«-æ…¢-å›å¼¹" æ•ˆæœ
            const distance = (totalItems + 1) * itemHeight;
            reel.style.transition = 'transform 3s cubic-bezier(0.1, 0.9, 0.2, 1)';
            reel.style.transform = `translateY(-${distance}px)`;

            // åŠ¨ç”»ç»“æŸå›è°ƒ
            setTimeout(() => {
                isSpinning = false;
                spinBtn.disabled = false;
                spinBtn.innerText = "ğŸ² ä¸æ»¡æ„ï¼Ÿé‡æ¥";
                
                // åŠ¨ç”»ç»“æŸåï¼Œä¸ºäº†ä¸è®© DOM æ— é™å¢é•¿ï¼Œé‡ç½®åˆ°æœ€ç»ˆçŠ¶æ€
                // è¿™é‡Œçš„ trick æ˜¯ï¼šè§†è§‰ä¸Šçœ‹èµ·æ¥åœäº†ï¼Œå…¶å®ç¬é—´æ›¿æ¢æˆåªæœ‰ä¸€é¡¹çš„åˆ—è¡¨
                renderStatic(finalItem);
            }, 3000);
        }

        // 4. ç®¡ç†é¢æ¿é€»è¾‘
        const modal = document.getElementById('manager-modal');
        const listDiv = document.getElementById('manage-list');

        function openManager() {
            modal.classList.add('open');
            renderList();
        }

        function closeManager() {
            modal.classList.remove('open');
        }

        function renderList() {
            const list = db[currentMode];
            listDiv.innerHTML = list.map((item, index) => `
                <div class="list-item">
                    <div>
                        <div style="font-weight:bold">${item.n}</div>
                        <div style="font-size:12px;color:#999">${item.s}</div>
                    </div>
                    <button class="del-btn" onclick="delItem(${index})">åˆ é™¤</button>
                </div>
            `).join('');
        }

        function addItem() {
            const nameInput = document.getElementById('new-name');
            const catInput = document.getElementById('new-cat');
            
            if(!nameInput.value) return alert("å†™ä¸ªèœåå•Š");

            db[currentMode].unshift({
                n: nameInput.value,
                s: catInput.value || "è‡ªå®šä¹‰",
                d: "è¿™æ˜¯ä½ äº²è‡ªé€‰çš„ç¾å‘³"
            });
            
            saveData(db); // ä¿å­˜åˆ°æœ¬åœ°
            renderList(); // åˆ·æ–°åˆ—è¡¨
            
            nameInput.value = '';
            catInput.value = '';
        }

        function delItem(index) {
            if(confirm('ç¡®å®šåˆ é™¤è¿™ä¸ªå—ï¼Ÿ')) {
                db[currentMode].splice(index, 1);
                saveData(db);
                renderList();
            }
        }
        
        // ç‚¹å‡»é®ç½©å…³é—­
        modal.addEventListener('click', (e) => {
            if(e.target === modal) closeManager();
        })

    </script>
</body>
</html>
